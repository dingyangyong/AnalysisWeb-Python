{% load url from future %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <meta charset="utf-8">
    <title>{% block title %}{% endblock %}应用统计系统</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{{ STATIC_URL }}images/favicon.png">
    <link rel="stylesheet" href="{{ STATIC_URL }}stylesheets/font-awesome/css/font-awesome.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}stylesheets/entypo/css/entypo.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}javascripts/dom/tablesorter/style.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}javascripts/dom/tipsy/tipsy.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}javascripts/dom/jqueryui/jquery.ui.all.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}stylesheets/main.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}javascripts/visualization/rickshaw/rickshaw.min.css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}css/base.css" />
{#    <script language="javascript" type="text/javascript" src="https://www.google.com/jsapi"></script>#}
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/jquery/jquery-1.8.3.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/underscore-min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/prefixfree.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/moment/moment.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/moment/moment.isocalendar.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/moment/lang-all.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/handlebars.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/backbone-min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/jquery.i18n.properties-min-1.0.9.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/jstz.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/store+json2.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/utils/jquery.idle-timer.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/jquery.form.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/tipsy/jquery.tipsy.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/jquery.noisy.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/tablesorter/jquery.tablesorter.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/jquery.sticky.headers.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/jqueryui/jquery-ui-1.8.22.custom.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/jqueryui/jquery-ui-i18n.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/slimScroll.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/dom/jquery.easing.1.3.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/jquery.peity.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/flot/jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/flot/jquery.flot.tickrotor.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/flot/jquery.flot.pie.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/flot/jquery.flot.resize.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/flot/jquery.flot.stack.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/gauge.min.js"></script>
{#    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/d3/d3.min.js"></script>#}
{#    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/d3/d3.layout.min.js"></script>#}
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/visualization/rickshaw/rickshaw.min.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.demo.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.common.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.config.sample.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.event.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.session.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.city.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.location.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.user.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.device.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.device.detail.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.app.version.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.carrier.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}javascripts/countly/countly.template.bak.js"></script>

    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/highcharts.js"></script>
    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/exporting.js"></script>

    <script language="javascript" type="text/javascript" src="{{ STATIC_URL }}js/base.js"></script>
    {% block extra_head %}{% endblock %}
</head>
<body>
<div id="sidebar">
    <div id="new-install-overlay"></div>
    <div id="sidebar-top">
        <a href="/"><div id="sidebar-logo"></div></a>
        <div id="sidebar-app-select">
            <div class="logo" style="background-image: url('{{ project.icon }}');"></div>
            <div class="text">{{ project.name }}</div>
        </div>
    </div>
    <div id="sidebar-menu">
        {% for g in project.group_set.all %}
            {% if role >= g.role %}
                {% if g.analysis_set.all.count == 1 %}
                    {% for a in g.analysis_set.all %}
                        {% if role >= a.role %}
                            <a href="{% url 'analysis_view' a.group.project.id a.group.id a.id %}" class="item{% if analysis and analysis.group.id == g.id %} active{% endif %}" id='root{{ g.id }}'>
                                <div class="logo">
                                    <i class="{{ g.icon }}" style="font-size: {{ g.icon_font_size }}px;"></i>
                                </div>
                                <div class="text">{{ g.name }}</div>
                            </a>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <a class="item{% if analysis and analysis.group.id == g.id %} active{% endif %}" id='root{{ g.id }}'>
                        <div class="logo">
                            <i class="{{ g.icon }}" style="font-size: {{ g.icon_font_size }}px;"></i>
                        </div>
                        <div class="text">{{ g.name }}</div>
                    </a>
                    <div class="sidebar-submenu" id="analytics-submenu{{ g.id }}"{% if analysis and analysis.group.id == group.id %} style="display: block;"{% endif %}>
                        {% for a in g.analysis_set.all %}
                            {% if role >= a.role %}
                                <a href="{% url 'analysis_view' a.group.project.id a.group.id a.id %}" class="item{% if analysis and analysis.id == a.id %} active{% endif %}" parent='root{{ a.id }}'>
                                    <div class="logo">
                                        <i class="{{ a.icon }}" style="font-size: {{ a.icon_font_size }}px;"></i>
                                    </div>
                                    <div class="text">{{ a.name }}</div>
                                </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>
    <div id="sidebar-bottom-container">
        <div class="menu">
            {#            <a class="item" id="account-settings">Settings</a>#}
            <a class="item" href="javascript:void(0);">数据更新: {{ update_date }}</a>
            <a class="item" href="{% url 'home_changepassword' %}">修改密码</a>
            <a class="item" href="{% url 'home_logout' %}">退出登录</a>
        </div>
        <div class="username" id="menu-username">
            Version: 1.3
        </div>
        <div class="reveal-menu"></div>
    </div>
</div>
<div id="app-nav">
    <div id="app-nav-head">
        <div id="app-nav-title" style="max-width: 120px;">应用</div>
    </div>
    <div class="apps-scrollable">
        {% for project in project_list %}
            {% if request.user in project.roles.all %}
        <a href="/{{ project.app_id }}/">
            <div class="app-container app-navigate">
                <div class="logo" style="background-image: url('{{ project.icon }}');"></div>
                <div class="name">{{ project.name }}</div>
                <div class="drag"></div>
            </div>
        </a>
            {% endif %}
        {% endfor %}
    </div>
    <div id="sidebar-new-app">
        <div class="app-container app-navigate" id="">
            <div class="logo"></div>
            <div class="name"></div>
            <div class="drag"></div>
        </div>
    </div>
</div>
<div></div>
<div id="content-container">
{% block body %}{% endblock %}
</div>
</body>
</html>
<script>
    (function($){
        $('#sidebar-menu').height($('#sidebar').height() - 112 - 65);
    })(jQuery);
</script>